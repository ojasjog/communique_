<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CommUnique - Voice Translator</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; padding:20px; background:#0072ff; color:#fff;}
h1 { font-size:2.5em; margin-bottom:10px;}
.card { background: rgba(255,255,255,0.1); padding:20px; margin:15px auto; border-radius:15px; max-width:600px;}
button { padding:10px 20px; margin:5px; font-size:1em; border-radius:8px; border:none; cursor:pointer; background:#00ffd5; color:#000; font-weight:bold;}
button:hover { background:#00ffa5;}
textarea { padding:10px; margin:5px 0; width:80%; border-radius:8px; border:none;}
audio { margin-top:10px; width:100%;}
</style>
</head>
<body>

<h1>CommUnique</h1>

<div class="card">
<h2>üé§ Speak Your Voice</h2>
<button id="recordBtn">Start Recording</button>
<audio id="audioPlayback" controls></audio>
</div>

<div class="card">
<h2>üìù Live Transcription</h2>
<textarea id="transcript" rows="4" placeholder="Transcribed text will appear here..."></textarea>
</div>

<div class="card">
<h2>üåê Translate & Generate Speech</h2>
<select id="langSelect">
  <option value="en">English</option>
  <option value="hi">Hindi</option>
  <option value="fr">French</option>
  <option value="es">Spanish</option>
  <option value="de">German</option>
  <option value="it">Italian</option>
  <option value="ja">Japanese</option>
  <option value="ko">Korean</option>
  <option value="ta">Tamil</option>
</select>
<button id="ttsBtn">Generate Speech</button>
<audio id="ttsAudio" controls></audio>
</div>

<script>
const recordBtn = document.getElementById('recordBtn');
const audioPlayback = document.getElementById('audioPlayback');
const transcriptArea = document.getElementById('transcript');
const langSelect = document.getElementById('langSelect');
const ttsBtn = document.getElementById('ttsBtn');
const ttsAudio = document.getElementById('ttsAudio');

let mediaRecorder;
let audioChunks = [];

recordBtn.addEventListener('click', async ()=>{
    if(recordBtn.textContent==="Start Recording"){
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder = new MediaRecorder(stream);
        audioChunks=[];
        mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
        mediaRecorder.onstop = async ()=>{
            const blob = new Blob(audioChunks,{type:'audio/wav'});
            audioPlayback.src = URL.createObjectURL(blob);

            // Send for transcription
            const formData = new FormData();
            formData.append("file", blob, "voice.wav");
            const resp = await fetch("/transcribe",{method:"POST", body: formData});
            const result = await resp.json();
            transcriptArea.value = result.text;
        };
        mediaRecorder.start();
        recordBtn.textContent="Stop Recording";
    }else{
        mediaRecorder.stop();
        recordBtn.textContent="Start Recording";
    }
});

ttsBtn.addEventListener('click', async ()=>{
    const text = transcriptArea.value.trim();
    if(!text){ alert("No text to translate!"); return;}
    const lang = langSelect.value;
    const formData = new FormData();
    formData.append("text", text);
    formData.append("lang", lang);
    const resp = await fetch("/translate_tts", {method:"POST", body: formData});
    const result = await resp.json();
    ttsAudio.src = result.tts_url;
});
</script>

</body>
</html>
